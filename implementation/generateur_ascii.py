"""
Générateur de labyrinthes via "dessin ASCII".

Authors: Dalker (daniel.kessler@dalker.org) & JCB for the art.
Date: 2021-04-09
"""

import itertools as it

import labyrinthe

import generateur_ab as ab


GRILLE10x10 = """
#####################
I     #             #
# # ### ######### ###
# #   #   #         #
# # # ########### # #
# # #   # #   # # # #
####### # # # # ### #
#   #   #   #   #   #
### ### ### ##### ###
#   #   # #   # # # #
### ### # ### # # # #
#   # # # # # #     #
# # # # # # # # # ###
# # # # #   # # # # #
# # # # ### # ### # #
# #       #   # #   #
# ####### ### # ### #
# #   # #   # #     #
# # ### # # # # # # #
#     #   #     # # O
#####################
"""


GRILLE20x20 = """
#########################################
I     # #       #   #   #     #         #
# ### # ### ##### ##### ### # # ### #####
#   #   #   # #     #     # #   #       #
# ##### # # # # ### # # # ### ####### # #
#     # # #     # # # # #   #       # # #
# # ### # ### ### ####### # # # ### ### #
# # # #     #         # # # # # # # #   #
# ### ### ####### ### # ### ##### ##### #
# #     # #         #         #         #
# # # ########### # ### ##### # # ##### #
#   #     #   #   # #   #       #     # #
# ##### ##### ### # ### # ##### # ### ###
#   # # # #       # #   #   # # # #     #
# ### # # ### ##### ### ### # ### # ### #
# # # #   # # #   # # # #   #     #   # #
# # # ### # ### ### # ### ### ######### #
# #     # # #       #   # #   # #   #   #
# ##### ### # # ### # ### ##### ### ### #
# #   # #     # #       # #       #     #
### # # # ### ##### # ######### #########
# # #   #   # # #   # #     # #       # #
# ### # # # # # # ####### ### ##### # # #
# # # #   # # # # #   # # #   #     # # #
# # ##### # # # # ### # # # # # # # ### #
#       # # # #   #     #   # # # # #   #
# ##### # ####### ### # ##### ### # # # #
#   #     #       #   #   #     # #   # #
# # # ######### ### # ##### # ####### ###
# # #     #         #       #     #     #
####### # # ##### ### ### ### ######### #
# #   # # #   #     #   # #   #   #     #
# ### ######### ####### ##### # ##### # #
#     #   #   # #     #     #     #   # #
# ### # # ### # # ######### ########### #
#   #   # #   #         #     # #     # #
####### ##### # ### ##### ##### # # # # #
#             # #   # #   # # #   # #   #
# # ##### ##### ### # ### # # # ##### ###
# #   #         #       #         #     O
#########################################
"""

GRILLE30x30 = """
#############################################################
I           #   # #               #       #     #   #       #
# ######### ### # ##### # # ### # # ##### ##### # # ### #####
# # #     #         #   # # #   #     # #     # # # #     # #
# # ### # ##### ######### ### ##### ### ####### # ### ### # #
# #   # #   # #   #         #   #   # #     # #   #   #     #
##### ##### # ### # ######### ####### ### ### ### ####### ###
# # # #   #       #       #         # #         #   #   # # #
# # # ### ##### ##### # ############# # # ### ##### # ### # #
# #     # # #   #     #   #   #     # # # # # # #   #     # #
# # ### # # ### ### ##### # # ##### # ##### # # # ### ### # #
#     #       # #   #   #   # #     # #     #   #     #   # #
##### ######### ### # ##### ####### # ##### ### # ####### # #
# #     #   #     # # #           # #     #     # # #   #   #
# # ### # # # # ##### # ### ##### # # ##### ### ### # ### ###
# # #     # # #       # #       #         # # #         # # #
# # ####### ######### # # ####### # # ##### # ########### # #
# #       #         #   # #       # # #   #             #   #
# # ####### ### # ### # ##### ### ##### # # ########### # ###
#   #     # # # #   # # #       # #     # #   #   #   #     #
# ### # ##### ### ### ######### ### ##### ### # # # ##### # #
# #   #   #   #   #       # #   # #     # #     #     #   # #
# # ### # ### # ######### # ##### # # ### # # # #############
# # #   # # #   # # # #   #   #   # #   #   # # # #   #     #
# # # # ### # # # # # # ### ##### ############# # # ##### ###
#   # # #     # # #         #         # #   #   #   #       #
### ##### ####### ### ########### ##### # ### # # ### # #####
#       #   #   #   #         #               #       #   # #
### ########### # ### ##### ### # ### ######### # ### # ### #
# #       #         # #       # # # #     #   # # #   #   # #
# ####### # ####### ##### ### ##### ####### # # ### # # ### #
#       # # #   # #   # # #         # # # # #   # # # # #   #
# ### ### # ### # ### # ####### ##### # # ##### # ### ### ###
# #                 #             #       #       #     #   #
### ##### ####### ### ### # ######### ####### ### ##### # # #
# # #   # # #   #   #   # # #   #   # # # #     # #   #   # #
# # ### ### # # # # # ####### ### ### # # # # ##### ### ### #
# #   #   #   #   # #         #     #   #   # #       #   # #
# # # # # # ### # ############# # ### ### ### ##### #########
#   # # # # # # #     #     #   # #   #   #   #   # #       #
# # # # # # # ####### ### ##### ### ##### # ### ### # ##### #
# # # # #   # #           #   # # #     # #     #     #   # #
# ####### # # ##### # # ### ### # ### # ####### ##### ### # #
# # #     #   # #   # #   #     #     #         #         # #
# # ##### ### # # ##### # # ##### ##### ####### # # ### ### #
# #   #   #   #   #   # # #   #   #   # #       # # #     # #
# ### ### ####### ### ### # # ### # # ### ### ####### ### ###
# # #   # #         #   #   #     # #   # # # # # # # #     #
# # # ######### ####### ### ##### # ### # # ### # # # # # ###
#             # # #     # #   # # # # #       #   # # # # # #
# ### ##### # ### ### # # # # # ### # # ######### # ### ### #
# # # # #   #   #     #   # #   #   #   #     # #   # #   # #
### # # ####### ##### ####### # # ### ### ### # # # # ### # #
# # # # #   # #       #       # # #   #     # #   #   #     #
# # # # # ### ### ##### ######### ### # # ### ### ######### #
# #         # #     # #     #   # #   # # # # #   #         #
# ### # ### # # ### # ### ### ####### # # # # # ### ####### #
# # # #   #   #   #   #   # # # # #     #   #   #       #   #
# # # # ########### # ### # # # # # ### # ### # # # ### ### #
#     #           # # #       #       # #   # #   # #     # O
#############################################################
"""


class LabyrintheAscii(labyrinthe.Labyrinthe):
    """Labyrinthe défini à partir d'une "carte" ascii rectangulaire."""

    def __init__(self, asciimap):
        """
        Initialiser labyrinthe.

        La carte doit contenir # pour les "murs", I pour l'entrée et O pour la
        sortie.
        """
        lignes = asciimap.strip().split("\n")
        assert all(len(ligne) == len(lignes[0]) for ligne in lignes),\
            "LabyrintheAscii suppose une grille rectangulaire en entrée"
        self._matrice = [[char for char in ligne] for ligne in lignes]
        self._n_rows = len(lignes)
        self._n_cols = len(lignes[0])
        self.start = None
        self.out = None
        for row, col in it.product(range(self._n_rows), range(self._n_cols)):
            if self._matrice[row][col] == "I":
                self.start = (row, col)
                self._matrice[row][col] == " "
            elif self._matrice[row][col] == "O":
                self.out = (row, col)
                self._matrice[row][col] == " "
        assert (self.start is not None and self.out is not None),\
            "Un labyrinthe doit avoir un départ et une sortie"
        self._ascii = "\n".join(["".join([char for char in ligne])
                                 for ligne in self._matrice])

    def __str__(self):
        return self._ascii

    def __contains__(self, cell):
        row, col = cell
        return False if self._matrice[row][col] == "#" else True

MAZE_XX = LabyrintheAscii(str(ab.Maze(10, 10)))
MAZE10 = LabyrintheAscii(GRILLE10x10)
MAZE20 = LabyrintheAscii(GRILLE20x20)
MAZE30 = LabyrintheAscii(GRILLE30x30)

if __name__ == "__main__":
    test = LabyrintheAscii("####\n#I O")
